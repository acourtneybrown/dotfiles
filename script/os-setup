#!/usr/bin/env bash

set -e

cd "$(dirname "$0")/.."
. script/functions
sudo_check_then_alive

# Check and install any remaining software updates.
if is_mac; then
  install_updates

  # install xcode command line tools
  script/install-xcode.sh

  # MacOS customization script
  script/macos

  # install homebrew
  script/install-homebrew.sh
  open -a 'App Store.app'
  echo "Login to Apple ID.  Press <enter> when done."
  read IGNORE

  # install LaunchDaemon to ensure mosh is added to fw allow list
  script/install-fix-mosh.sh
elif is_linux; then
  script/install-linuxbrew.sh
fi

# We can't control if some packages fail to install, so don't exit out
set +e
[ -z "$SKIP_BUNDLE" ] && script/brew_bundle
set -e

script/extract-onepassword-secrets.sh

# Setup development tools
script/golang-setup.sh
script/goenv-setup.sh
